.PHONY: build start serve stop down load_demo_data \
        dev-build dev-start dev-serve dev-stop dev-down dev-load_demo_data

# ----------- DEMO -----------
build:
	${INFO} "Creating demo image..."
	@ docker compose -f docker-compose.demo.manual.yml build --no-cache web
	${INFO} "Build completed"

start:
	${INFO} "Running demo services (foreground)"
	@ docker compose -f docker-compose.demo.manual.yml up

serve:
	${INFO} "Running demo services (detached)"
	@ docker compose -f docker-compose.demo.manual.yml up -d

stop:
	${INFO} "Stopping demo services"
	@ docker compose -f docker-compose.demo.manual.yml stop

down:
	${INFO} "Stopping demo services and deleting DB"
	@ docker compose -f docker-compose.demo.manual.yml down -v

load_demo_data:
	${INFO} "Loading demo data"
	@ docker compose -f docker-compose.demo.manual.yml exec web python manage.py loaddata aula/apps/*/fixtures/dades.json
	@ docker compose -f docker-compose.demo.manual.yml exec web python manage.py loaddemodata

# ----------- DEV -----------
dev-build:
	${INFO} "Creating dev image..."
	@ docker compose -f docker-compose.dev.yml build web
	${INFO} "Build completed"

dev-start:
	${INFO} "Running dev services (foreground)"
	@ docker compose -f docker-compose.dev.yml up

dev-serve:
	${INFO} "Running dev services (detached)"
	@ docker compose -f docker-compose.dev.yml up -d

dev-stop:
	${INFO} "Stopping dev services"
	@ docker compose -f docker-compose.dev.yml stop

dev-down:
	${INFO} "Stopping dev services and deleting DB"
	@ docker compose -f docker-compose.dev.yml down -v

dev-load_demo_data:
	${INFO} "Loading demo data in dev"
	@ docker compose -f docker-compose.dev.yml exec web python manage.py loaddata aula/apps/*/fixtures/dades.json
	@ docker compose -f docker-compose.dev.yml exec web python manage.py loaddemodata


# ----------- Aesthetics -----------
YELLOW := "\e[1;33m"
NC := "\e[0m"

INFO := @bash -c '\
  printf $(YELLOW); \
  echo "=> $$1"; \
  printf $(NC)' SOME_VALUE
